<link rel='stylesheet' type='text/css' href='/static/css/khanapi/tree-skin/ui.dynatree.css'>
<div id="topic-tree"></div>
<script src='/static/js/jquery.min.js' type='text/javascript'></script>
<script src='/static/js/jquery-ui.custom.min.js' type='text/javascript'></script>
<script src='/static/js/jquery.cookie.js' type='text/javascript'></script>
<script type="text/javascript" src='/static/js/khanapi/jquery.dynatree.min.js' ></script>
<!-- Add code to initialize the tree when the document is loaded: -->
<script type="text/javascript">
    $("#topic-tree").dynatree({
        onActivate : function(node) {
            // alert("You activated " + node.data.title);
        }
    });

    function addTopicNode(topicName, parentNode) {
        child = parentNode.addChild({
            title : topicName,
            tooltip : topicName,
            isFolder : true
        });
        return child;
    }
    
    function addLeafNode(leafKey, leafName, leafDescription, leafUrl, parentNode) {
        leaf = parentNode.addChild({
            key: leafKey,
            title : leafName,
            tooltip : leafName,
            isFolder : false,
            href: leafUrl
        });
        
        return leaf;
    }    

    // now that the tree is in place, get the root node
    var rootNode = $("#topic-tree").dynatree("getRoot");
    
    // for every json main topic, add a topic node to root
    {% for topic in topic_tree_json %}
        topicNode = addTopicNode('{{topic.name}}', rootNode)
        
        // Loop through the subitems - check if they are topics or items
        {% for subitem in topic.items %}
            // If there are subitems, add as a folder
            {% if subitem.items %}
                subtopicNode = addTopicNode('{{subitem.name}}', topicNode);
                
                // add children
                {% for subsubitem in subitem.items %}
                    // If there are subitems, add as a folder
                    {% if subsubitem.items %}
                        subsubtopicNode = addTopicNode('{{subsubitem.name}}', subtopicNode);
                        
                        {% for subsubsubItem in subsubitem %}
                            {% if subsubsubItem.items%}
                                subsubsubtopicNode = addTopicNode('{{subsubsubItem.name}}', subsubtopicNode);
                            {% endif %}
                        {% endfor %}
                        
                        {% for ex3 in subsubitem.exercises %}
                            addLeafNode('{{ex3.name}}', '{{ex3.display_name}}', '{{ex3.description}}', '{{ex3.ka_url}}', subsubtopicNode);
                        {% endfor %}
                    {% endif %}                   
                 {% endfor %}
                 
                 // done adding subtopics, add exercises now          
                {% for ex2 in subitem.exercises %}
                    addLeafNode('{{ex2.name}}', '{{ex2.display_name}}', '{{ex2.description}}', '{{ex2.ka_url}}', subtopicNode);
                {% endfor %}
            {% endif %}
        {% endfor %}
        
        // done adding topics, add exercises now          
        {% for ex1 in topic.exercises %}
            addLeafNode('{{ex1.name}}', '{{ex1.display_name}}', '{{ex1.description}}', '{{ex1.ka_url}}', topicNode);
        {% endfor %}        
    {% endfor %}

    
</script>