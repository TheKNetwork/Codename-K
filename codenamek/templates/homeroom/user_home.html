{% extends "default_layout.html" %}

{% block js %}
<script type="text/javascript" src="/static/js/homeroom.js"></script>
{% endblock %}

{% block content %}

{% if messages %}
    <div class="alert alert-success">
        {% for msg in messages %}
            {{ msg }}
        {% endfor %}
    </div>
{% endif %}

<!-- Invite Users Modal -->
<div class="modal hide" id="invite-users">
	<div class="modal-header">
		<a class="close" data-dismiss="modal">Ã—</a>
		<h3>Invite Users</h3>
	</div>

	<div class="modal-body">
		<h6>Share this URL to invite users to your Class:</h6>
		<p>			 
			<span id="#invite-url">http://knetwork.org/invite#2342</span>
			(<a href=#copy-to-clipboard> Copy URL </a>)
		</p>
	
		<!-- TO-DO: notify K Network Users internally and via E-Mail
		<div class="well">
			<h4>Invite K Network Users</h4>
		</div>
	
		<div class="well">
			<h4>Let us e-mail invites for you!</h4>
		</div>
		-->
	</div>

	<div class="modal-footer">
		<a href="#" data-dismiss="modal" class="btn">Close</a>
	</div>
</div>

<!-- Bread Crumb Navigation -->
<section>
	<div id="breadcrumbs span12">
		<ul class="breadcrumb">
			<li>
				<i class="icon-home"></i> Homeroom
			</li>
		</ul>
	</div>
</section>

<!-- include the tag lib in the page... allows use of the following existing tags:
        
    khan_user_login (shows a login to khan button if they aren't logged in, otherwise invisible)
    khan_user_data (shows a big table of the user variables returned from khan)
    khan_exercises (shows a table of the exercises)
    khan_badges    (shows the user's badge info)
    khan_user_exercise_history (shows the user exercise history)

-->
{% load khan_tags %}
<div id="khan_login">
{% khan_user_login %}
</div>

<section id="school">
	
	<br />	
	<div id="school-actions">
		{% if main_school %}	
		<div id="create-class" class="btn btn-primary pull-left">Create Class</div>
		{% endif %}
		
		<div id="class-filter">
			<form>
				<fieldset>
					<div class="control-group"> 
						<div class="controls">
							<select id="class-filter">
								<option>Show All Classes</option>
								<option>Show My Classes</option>
							</select>
						</div>
					</div>
				</fieldset>
			</form>
		</div>
	</div>

	<h3>My School: <small>{{ main_school }}</small></h3> 
	<div id="class-list">
		<div class="row-fluid">
			<div class="span12">
				<table class="table table-striped table-condensed">
					<thead>
						<tr>
							<th>Class Name</th>
							<th>Info</th>
							<th>Actions</th>	
							<th></th>
						</tr>
					</thead>
		
					<tbody>
						<tr>
						{# Show Create Class Alert if there are no classes #}	
						{% if main_school == none %}
							<td>
								<div id="new-user-prompt" class="alert alert-info span4">
									<a id="create-class" href="/{{ user }}/schools/{{ main_school.id }}/create_a_class">Create a Class</a> 
									and invite users {% if classes %}, or request to join a class listed below {% endif %} to get started
						
								</div>
							</td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						{% endif %}

						{# Inline form to create a class #}
						<tr id="create-class-row" class="hide">
							<form id="addClassroomForm" action="/{{ user }}/schools/{{main_school.id}}/create_a_class" method="post">{% csrf_token %}
								<td class="classname">
									<i class="icon-book"></i>
									<input id="id_class_name" 
											name="class_name"
											type="text"
											placeholder="Classname">
									</input>
									<span id="create-class-row-buttons" class="span4">
										<a id="cancel-class-creation" name="cancel-class-creation" type="" class="btn btn-danger">Cancel</a>
										<button id="submit" name="submit" type="submit" class="btn btn-success">Confirm</button>
									</span>
								</td>
								<td></td>
								<td></td>
								<td></td>
							</form>
						</tr>
						{# loop through current classes #}	
						{% for classroom in main_school.classrooms.all %}
						<tr>
							<td class="classname" ><a href='/{{ user }}/schools/{{main_school.id}}/{{ classroom.id }}'><i class="icon-book"></i> {{classroom}}</a></td>
							<td><a href='#{{ classroom.name }}-users'
									rel="users"
									data-original-title="{{ classroom }} Users" 
									data-content="<table>
													{% for user in classroom.user_set.all %}
													<tr>
														<td>{{ user }}</td>
														<td>{{ user.last_name }}, {{ user.first_name }}</td>
													</tr>
													{% endfor %}
													</table>"
																				
									data-placement="left">	
								<i class="icon-user"></i> {{classroom.user_set.all.count}} Users</a></td>
							<td><a href="#invite-users" data-toggle="modal"><i class="icon-plus-sign"></i> Invite Users</a></td>
							<td><a href=#pending-invites>{{ classroom.invitations.count }} Pending Invites</a></td>
						</tr>
						{% endfor %}
					</tbody>	
				</table>
			</div>
		<div>
	</div>
</section>


<section>
    <div id="khan-user-data" class="span6 well">
    </div>
    
    <div class="span4 well">
        <h3>Available Live Sessions</h3> 
        <div id="whiteboard-list">
            <div class="row-fluid">
                <div class="span6">
                    <table class="table table-striped table-condensed">
                        <thead>
                            <tr>
                                <th>Whiteboard</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for whiteboard in whiteboard_sessions %}
                            <tr>
                                <td><a href="/classroom/{{ whiteboard.id }}">{{ whiteboard.whiteboard_title }}</a></td>
                            </tr>
                            {% endfor %}
                            <tr>
                                <td>
                                    <br/><br/>
                                    <form id="createWhiteboardForm" action="/classroom/create_whiteboard" method="post">{% csrf_token %}
                                        <input id="id_whiteboard_title" 
                                                name="whiteboard_title"
                                                type="text"
                                                placeholder="Whiteboard Title"/>
                                        <input type="submit" name="submit" value="Create Session" class="btn btn-primary"/>
                                    </form>
                                </td>
                                
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>        
    </div>
    
    <div class="span4 well">
        {% khan_badges %}
    </div>
    
</section>
{% load socketio_tags %}
{% socketio %}
      
<script type="text/javascript">
    $("#khan-user-data").load('/khan/khan_user_info');
</script>
      
{% endblock %}
